#!/bin/bash

# do not edit below ############################################################

source /etc/wart-menu/wart.config

# function for wallet command ##################################################
wallet_command() {
  "$WARTHOG_DIR"/wallet/./wart-wallet --file="$WALLET_JSON" "$CMD"
}

# function for dialog display ##################################################
display_function() {
  # display function
  display_result() {
    dialog --title "$BACKTITLE" \
      --no-collapse \
      --msgbox "$(wallet_command)" "$(echo "4+$(wallet_command | wc -l)" | bc 2>/dev/null)" "$(echo "5+$(wallet_command | wc -L)" | bc 2>/dev/null)"
  }
  display_result
}

# function to print wallet balance #############################################
print_balance() {
  # balance
  CMD="-b"
  # display function
  display_result() {
    dialog --title "$BACKTITLE" \
      --no-collapse \
      --msgbox "Balance: $(wallet_command) WART" 5 "$(echo "18+$(wallet_command | wc -L)" | bc 2>/dev/null)"
  }
  display_result
}

# function to print wallet address #############################################
print_address() {
  # address
  CMD="-a"
  # display function
  display_result() {
    dialog --title "$BACKTITLE" \
      --no-collapse \
      --msgbox "Address: $(wallet_command)" 5 "$(echo "13+$(wallet_command | wc -L)" | bc 2>/dev/null)"
  }
  display_result
}

# function to send transaction #################################################
send_tx() {
  echo "BETA! Still building.."
  sleep 1
}

# function for wallet files ####################################################
wallet_file() {
  # display function
  display_result() {
    dialog --title "$BACKTITLE" \
      --no-collapse \
      --msgbox "$(ls -lRt "$WARTHOG_DIR"/wallet/)" 0 0
  }
  display_result
}

# function for create wallet ###################################################
create_wallet() {
  echo "BETA! Still building.."
  sleep 1
}

# function to restore wallet ###################################################
restore_wallet() {
  echo "BETA! Still building.."
  sleep 1
}

# function to display the version ##############################################
print_version() {
  # version
  CMD="--version"
  display_function
}

# function to display help #####################################################
print_help() {
  # help
  CMD="--help"
  display_function
}

# menu #########################################################################
HEIGHT="14"
WIDTH="28"
CHOICE_HEIGHT="14"
BACKTITLE="Warthog Wallet"
TITLE="Wart-Wallet"
MENU=""

OPTIONS=(
  1 "Wallet balance"
  2 "Wallet address"
  3 "Send transaction"
  4 "Wallet files"
  5 "Create wallet"
  6 "Restore wallet"
  7 "Print version"
  8 "Help")

CHOICE=$(dialog --clear \
  --backtitle "$BACKTITLE" \
  --title "$TITLE" \
  --menu "$MENU" \
  $HEIGHT $WIDTH $CHOICE_HEIGHT \
  "${OPTIONS[@]}" \
  2>&1 >/dev/tty)

clear
case $CHOICE in
"1") print_balance ;;  # print wallet balance
"2") print_address ;;  # print wallet address
"3") send_tx ;;        # send transaction
"4") wallet_file ;;    # wallet files
"5") create_wallet ;;  # create new wallet
"6") restore_wallet ;; # restore old wallet
"7") print_version ;;  # print wallet version
"8") print_help ;;     # print help commands
"*") break ;;
esac

# END
