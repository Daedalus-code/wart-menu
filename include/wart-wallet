#!/bin/bash

# do not edit below ############################################################

source /etc/wart-menu/wart.config

# function to print wallet balance #############################################
print_balance() {
  # balance
  RESULT="$("$WARTHOG_DIR"/wallet/./wart-wallet --file="$WARTHOG_JSON" -b)"
  # display function
  display_result() {
    dialog --title "$BACKTITLE" \
      --no-collapse \
      --msgbox "Balance: $(echo "$RESULT") WART" 5 "$(echo "18+$(echo "$RESULT" | wc -L)" | bc 2>/dev/null)"
  }
  display_result
}

# function to print wallet address #############################################
print_address() {
  # address
  RESULT="$("$WARTHOG_DIR"/wallet/./wart-wallet --file="$WARTHOG_JSON" -a)"
  # display function
  display_result() {
    dialog --title "$BACKTITLE" \
      --no-collapse \
      --msgbox "Address: $RESULT" 5 "$(echo "13+$(echo $RESULT | wc -L)" | bc 2>/dev/null)"
  }
  display_result
}

# function to send transaction #################################################
send_tx() {
  echo "BETA! Still building.."
  sleep 1
}

# function for wallet files ####################################################
wallet_file() {
  # display function
  display_result() {
    dialog --title "$BACKTITLE" \
      --no-collapse \
      --msgbox "$(ls -lRt "$WARTHOG_DIR"/wallet/)" 0 0
  }
  display_result
}

# function for create wallet ###################################################
create_wallet() {
  echo "BETA! Still building.."
  sleep 1
}

# function to restore wallet ###################################################
restore_wallet() {
  echo "BETA! Still building.."
  sleep 1
}

# function to display help #####################################################
print_help() {
  # help
  RESULT="$("$WARTHOG_DIR"/wallet/./wart-wallet --file="$WARTHOG_JSON" --help)"
  # display function
  display_result() {
    dialog --title "$BACKTITLE" \
      --no-collapse \
      --msgbox "$RESULT" 0 0
  }
  display_result
}

# menu #########################################################################
HEIGHT="14"
WIDTH="28"
CHOICE_HEIGHT="14"
BACKTITLE="Warthog Wallet"
TITLE="Wart-Wallet"
MENU="Load: $(awk '{ print $1,$2,$3 }' /proc/loadavg 2>/dev/null)"

OPTIONS=(
  1 "Wallet balance"
  2 "Wallet address"
  3 "Send transaction"
  4 "Wallet files"
  5 "Create wallet"
  6 "Restore wallet"
  7 "Help")

CHOICE=$(dialog --clear \
  --backtitle "$BACKTITLE" \
  --title "$TITLE" \
  --menu "$MENU" \
  $HEIGHT $WIDTH $CHOICE_HEIGHT \
  "${OPTIONS[@]}" \
  2>&1 >/dev/tty)

clear
case $CHOICE in
"1") print_balance ;;  # print wallet balance
"2") print_address ;;  # print wallet address
"3") send_tx ;;        # send transaction
"4") wallet_file ;;    # wallet files
"5") create_wallet ;;  # create new wallet
"6") restore_wallet ;; # restore old wallet
"7") print_help ;;     # print help commands
"*") break ;;
esac

# END
